#########################################
#  UCG Cart - Stage 3
#########################################

#$CartButton off
#$PatientButton off
$ProcedureButton off
$Cart2Button on

#$ECGCan on

$CartClothFolded outline.on
$ContinenceSheet outline.on
$InjectionWater outline.on
$Antiseptic outline.on
$SyringePackage outline.on
$LubricantPackage outline.on
$Lubricant outline.on
$Catheter outline.on
$UrineBag outline.on
$Gloves outline.on
$Syringe outline.on
$Tape outline.on
$CottonBalls outline.on

$CartClothFolded clickable true
$ContinenceSheet clickable true
$InjectionWater clickable true
$Antiseptic clickable true
$SyringePackage  clickable true
$Lubricant clickable true
$LubricantPackage clickable true
$Catheter clickable true
$UrineBag clickable true
$Gloves clickable true
$Syringe clickable true
$Tape clickable true
$CottonBalls clickable true

$Patient clickable false
$Patient outline.off

label 'CartLoop'

	If
		$Cart pressed
	Then
		$Cart reset
		Player align $CartLook 0.5
	Endif

	If
		$CartButton pressed
	Then
		$CartButton reset
		Player align $CartLook 0.5
	Endif

	If
		$Cart2 pressed
	Then
		$Cart2 reset
		Player align $CartLook1 0.5
	Endif

	If
		$CartClothFolded pressed
	Then
		$CartClothFolded reset
		Do 'UCGActions/UnfoldCloth'
	Endif

	If
		$Cart2Button pressed
	Then
		$Cart2Button reset
		Player align $CartLook1 0.5
	Endif

	If
		$LeftHandButton pressed
	Then
		Prompt 'Left Hand is Active'
		Wait 1
		Prompt ''
		$LeftHandButton reset
		$ActiveHand = 'Left'
		$OtherHand = 'Right'
	Endif

	If
		$RightHandButton pressed
	Then
		Prompt 'Right Hand is Active'
		Wait 1
		Prompt ''
		$RightHandButton reset
		$ActiveHand = 'Right'
		$OtherHand = 'Left'
	Endif

	If
		$HandScrub pressed
	Then
		$HandScrub reset
		Do 'UCGActions/HandScrub.txt'
	Endif

	If
		$ContinenceSheet pressed
	Then
		$ContinenceSheet reset
		Do 'UCGActions/ContinenceSheet.txt'
	Endif

	If
		$InjectionWater pressed
	Then
		$InjectionWater reset
		Do 'UCGActions/InjectionWater.txt'
	Endif

	If
		$Antiseptic pressed
	Then
		$Antiseptic reset
		Do 'UCGActions/Antiseptic.txt'
	Endif

	If
		$Lubricant pressed
	Then
		$Lubricant reset
		Do 'UCGActions/Lubricant.txt'
	Endif

	If
		$SyringePackage pressed
	Then
		$SyringePackage reset
		Do 'UCGActions/OpenSyringe.txt'
	Endif

	If
		$LubricantPackage pressed
	Then
		$LubricantPackage reset
		Do 'UCGActions/OpenLubricant.txt'
	Endif

	If
		$InjectionWaterPackage pressed
	Then
		$InjectionWaterPackage reset
		Do 'UCGActions/OpenInjectionWater.txt'
	Endif

	If
		$Catheter pressed
	Then
		$Catheter reset
		Do 'UCGActions/OpenCatheter.txt'
	Endif

	If
		$CatheterBalloon pressed
	Then
		$CatheterBalloon reset		
		If
			$SyringeFull = true
		Then

			ZoomSpot Menu.Question 'Test Catheter balloon for leaks?'
			ZoomSpot Menu.Choices 'Yes','No'
			ZoomSpot Menu.on ZoomSpot
			WaitFor
				ZoomSpot Menu.Done
			Wait .1
			If
				ZoomSpot menu.result 'Yes'
			Then
				$TempCatheter = 'CatheterBalloon'

				Create $TempCatheter $TempCatheter

				$TempCatheter align $CatheterBalloon 0

				turnOff $CatheterBalloon

				$CatheterPort = $TempCatheter + '/Handle/Port'
				wait 1

				$TempCatheter localmovey .2 1
				wait 1
				$TempCatheter localmovez .08 1
				wait 1
				$TempCatheter localmovex .06 1
				wait 1

				$Syringe align $CatheterPort 1
				wait 1

#				$Syringe localrotatex -90 .1
#				wait .2
#				$Syringe localmovey .06 .1
#				wait .2

				#push in water
				$Plunger localmovey -.06 2
				turnOff $SyringeWater
				$TempCatheter play Grow true
				wait 4

				#pull out water
				$Plunger localmovey .06 2
				wait 2
				turnOn $SyringeWater
				$TempCatheter play Grow false
				wait 2
				$TempCatheter moveto $CatheterPos 1
				wait .5

				#put back curled version
				turnOn $CatheterBalloon
				Destroy $TempCatheter
				$CatheterBalloon clickable false
				wait 1
				$Syringe moveto $CatheterPos
				wait 1
				Prompt 'No leaks found'
				wait 2
				Prompt ''

				turnOn $Stage4Button
			Endif
		Endif
	Endif

	If
		$UrineBag pressed
	Then
		$UrineBag reset
		Do 'UCGActions/AttachUrineBagBed.txt'
	Endif

	If
		$Gloves pressed
	Then
		$Gloves reset
		Do 'UCGActions/Gloves.txt'
	Endif

	If
		$Syringe pressed
	Then
		$Syringe reset
		Do 'UCGActions/Syringe.txt'
	Endif

	If
		$Tape pressed
	Then
		$Tape reset
		Do 'UCGActions/DetachTape.txt'
	Endif

	If
		$DetachedTape pressed
	Then
		$DetachedTape reset
		Do 'UCGActions/TapeCatheter.txt'
	Endif


	If
		$CottonBalls pressed
	Then
		$CottonBalls reset
		Do 'UCGActions/CottonBalls.txt'
	Endif

	If
		$PatientButton pressed
	Then
		$PatientButton reset
		Do 'UCGActions/ExitCart.txt'
		Return
	Endif

	wait .2
Goto 'CartLoop'