#/PatientCanvas off
JoystickCanvas on
$Patient outline.on
$Cart outline.on
$Vitalsmonitor outline.on
#Prompt 'Playerstart = ' + PlayerStart
$PatientLocator = $Patient + '/Locator'
Do 'NEWS_Nurse/Stage1/COWSetup.txt'
Wait .51

If
	$PatientInPosition = 'true'
Then
	$Patient clickable false
Endif
$CatheterInserted = 'false'
Do 'SummaryCheck.txt'

$GlobalVar setglobal 'UsingTool' false

Label 'LoopN1'

	$UsingTool =
	  $GlobalVar getGlobal 'UsingTool'

	If
		$SumButton pressed
	Then
		$SumButton reset
		$GlobalVar setglobal 'UsingTool' true
		$CheckCanvas off
		PatInfoCanvas off
		Do 'SummaryCheck.txt'
		$GlobalVar setglobal 'UsingTool' false
	Endif


	If
		$EndGame isOnAndPressed
	Then
		#Do 'EndCheck.txt'
		If
			$BedNumber = 1
		Then
			ScoreTracker EndStage
		Endif

		Wait 1

		If
            $BedNumber = 1
        Then		
            ScoreTracker CloseStage
        Endif
        
        Wait 1  #needed for scorm
        SceneManager switchtoscene Scenes/MainMenu
	Endif

	If
		$PatientButton pressed
	Then
		$PatientButton reset
		Player align $PlayerStart 1
	Endif

	If
		$CartButton pressed
	Then
		$CartButton reset
		Player align $CartLook 1
		$CartObj outline.off
		$GlobalVar setglobal 'UsingTool' true
		$ECGCan on
		Player align $CartLook .5
		turnOff $SumButton
		$CartObj clickable false
		$CartButton off
		$PatientButton off
		$ProcedureButton off

		Do 'UCG/UCGCartStage4.txt'
	Endif

	If
		$ProcedureButton pressed
	Then
		$ProcedureButton reset
		Player align $UrinaryProcPos 1
	Endif


	If
		$CartObj pressed
	Then
		$CartObj reset
		$CartObj outline.off
		$GlobalVar setglobal 'UsingTool' true
		$ECGCan on
		Player align $CartLook .5
		turnOff $SumButton
		$CartObj clickable false

		Do 'UCG/UCGCartStage4.txt'
	Endif


	If
		$PatientSign pressed
	Then
		$PatientSign reset
		$GlobalVar setglobal 'UsingTool' true
		Player align $LookAtPatientSign 1
		$ECGCan on
		label 'signLoop'
		If
			$BackECG pressed
		Then
			$BackECG reset
			$ECGCan off
			Player align $PlayerStart 1
			Wait .5
			$UseToolButton reset
			$GlobalVar setglobal 'UsingTool' false
			Goto 'LoopN1'
		Endif
		Goto 'signLoop'
	Endif



	If
		$Patient pressed
	Then
		$Patient reset
		If
			$PatientInPosition = 'false'
		Then
			Do 'UCGTools/PositionPatient.txt'
		Endif
		If
			$CatheterInserted = 'true'
		Then
			ZoomSpot Menu.Question 'Remove Drape?'
			ZoomSpot Menu.Choices 'Yes','No'
			ZoomSpot Menu.on ZoomSpot
			WaitFor
				ZoomSpot Menu.Done
			Wait .1
			If
				ZoomSpot menu.result 'Yes'
			Then
				Destroy $Drape
				turnOn $Pillow
				$Patient play ExamPos false
			Endif
		Endif
	Endif 

	If
		$CatheterBalloon pressed
	Then
		$CatheterBalloon reset
		

		ZoomSpot Menu.Question 'Insert Catheter?'
		ZoomSpot Menu.Choices 'Yes','No'
		ZoomSpot Menu.on ZoomSpot
		WaitFor
		ZoomSpot Menu.Done
		Wait .1

		If
			ZoomSpot menu.result 'Yes'
		Then
			ZoomSpot Menu.Question 'Where to insert?'
			ZoomSpot Menu.Choices 'Urethra','Vagina'
			ZoomSpot Menu.on ZoomSpot
			WaitFor
				ZoomSpot Menu.Done
			Wait .1

			$TempCatheter = 'CatheterBalloon'
			$UCLocator = $Patient + '/UCLocator'
			$CatheterPort = $TempCatheter + '/Handle/Port'

			Create $TempCatheter $TempCatheter
			$TempCatheter align $CatheterBalloon 0

			turnOff $CatheterBalloon
			wait .1
			$TempCatheter localmovey .01 0
			wait 1

			$TempCatheter align $UCLocator 1
			wait 1

				ZoomSpot Menu.Question 'What should you do next?'
				ZoomSpot Menu.Choices 'Inflate the balloon with 10 CC water for injection','Insert another 2.5cm and inflate the balloon with 10cc water for injection.'
				ZoomSpot Menu.on ZoomSpot
				WaitFor
					ZoomSpot Menu.Done
				Wait .1
				If
					ZoomSpot menu.result 'Inflate the balloon with 10 CC water for injection'
				Then
					$Syringe align $CatheterPort 1
					wait 1
					$Plunger localmovey -.06 2
					wait 2
				Else
					$TempCatheter localmovez .02 1
					wait 1
					$Syringe align $CatheterPort 1
					wait 1
					$Syringe localrotatex -90 .1
					wait .2
					$Syringe localmovey .12 .1
					wait .2
					$Plunger localmovey -.06 2
					wait 2
				Endif

				$Syringe moveto $CatheterPos .2
				wait .3
				$Syringe attachto $UCGKidneyDish

				$PouringLiquid = 'UrineParticles'
				Create $PouringLiquid $PouringLiquid
				Wait 0
				$PouringLiquid align $CatheterPort 0
				Wait 0
				$PouringLiquid localmovex .02 0
				Wait 0
				$PouringLiquid localrotatey 180 0
				wait 0

				$TempCatheter localmovez -.01 .1
				wait .2
				$TempCatheter localmovez .01 .1
				wait .2
				
				$CatheterInserted = 'true'
		Endif
	Endif

	If
		$UrineBag pressed
	Then
		$UrineBag reset
		Prompt 'Urine Bag'
		wait .5
		Prompt ''
		If
			$CatheterInserted = 'true'
		Then
			ZoomSpot Menu.Question 'Connect Catheter to Urine Bag?'
			ZoomSpot Menu.Choices 'Yes','No'
			ZoomSpot Menu.on ZoomSpot
			WaitFor
				ZoomSpot Menu.Done
			Wait .1
			If
				ZoomSpot menu.result 'Yes'
			Then
				$UrineBag clickable false
				$UrineBag outline.off

				$UCGKidneyDish align $CartPos6 1
				wait 1

				$IVLine = 'UCIVLine'
				Create $IVLine $IVLine
				$IVLine moveto $UrineBagPos 0
				wait 0
				Destroy $PouringLiquid

				turnOn $EndGameButton
				$Patient clickable true
				$Patient outline.on
			Endif
		Endif
	Endif

	If
		$EndGameButton pressed
	Then
		$EndGameButton reset
		ZoomSpot Menu.Question 'What are the post procedure care?'
		ZoomSpot Menu.Choices 'Cathter insertion details','Amount of urine in the intake and output chart','Signs of urinary tract infection','All of the above'
		ZoomSpot Menu.on ZoomSpot
		WaitFor
			ZoomSpot Menu.Done
		Wait .1
		Do 'EndCheck.txt'
	Endif

#	If
#		$Patient pressed
#	Then
#		$Patient reset
#		ZoomSpot Menu.Question 'Player hand reach'
#		ZoomSpot Menu.Choices 'grip','extension','pinch','ring','thumb','tripod','tweeze'
#		ZoomSpot Menu.on ZoomSpot
#		WaitFor
#			ZoomSpot Menu.Done
#		Wait .1
#		If
#			ZoomSpot menu.result 'grip'
#		Then
#			$PlayerNurse grabRight $PatientLocator 1 'vertical' 'R_grip'
#			Wait 5
#			$PlayerNurse release 1 'R_grip'
#		Endif
#
#		If
#			ZoomSpot menu.result 'extension'
#		Then
#			$PlayerNurse grabRight $PatientLocator 1 'vertical' 'R_extension'
#			Wait 3
#			$PlayerNurse release 1 'R_extension'
#		Endif
#
#		If
#			ZoomSpot menu.result 'pinch'
#		Then
#			$PlayerNurse grabRight $PatientLocator 1 'vertical' 'R_pinch'
#			Wait 3
#			$PlayerNurse release 1 'R_pinch'
#		Endif
#
#		If
#			ZoomSpot menu.result 'ring'
#		Then
#			$PlayerNurse grabRight $PatientLocator 1 'vertical' 'R_ring'
#			Wait 3
#			$PlayerNurse release 1 'R_ring'
#		Endif
#
#		If
#			ZoomSpot menu.result 'thumb'
#		Then
#			$PlayerNurse grabRight $PatientLocator 1 'vertical' 'R_thumb'
#			Wait 3
#			$PlayerNurse release 1 'R_thumb'
#		Endif
#
#		If
#			ZoomSpot menu.result 'tripod'
#		Then
#			$PlayerNurse grabRight $PatientLocator 1 'vertical' 'R_tripod'
#			Wait 3
#			$PlayerNurse release 1 'R_tripod'
#		Endif
#
#		If
#			ZoomSpot menu.result 'tweeze'
#		Then
#			$PlayerNurse grabRight $PatientLocator 1 'vertical' 'R_tweeze'
#			Wait 3
#			$PlayerNurse release 1 'R_tweeze'
#		Endif
#	Endif

	If
		$Vitalsmonitor pressed
	Then
		$Vitalsmonitor reset
		Do 'ToolTxt/AssessECG.txt'
	Endif

	If
		$Scene_Exit pressed
	Then 
		$Scene_Exit reset
		#ScoreTracker rangecomplete 0-14
		Do 'EndCheck.txt'
	Endif

	If
		$Check_End pressed
	Then
		$Check_End reset
		$CheckCanvas off
	Endif

	Wait .2
Goto 'LoopN1'
