#/PatientCanvas off
JoystickCanvas on
$Patient outline.on
$Cart outline.on
$Vitalsmonitor outline.on
#Prompt 'Playerstart = ' + PlayerStart
#Wait .51

$BackECG = 'ECGCheckCanvas/Choices/Exit'

WipeCanvas off
/SyringeCanvas off
/IVCanvas off
/DripCanvas off

$RightRail = $Bed + '/RightRail'
$RightRail outline.on

$HandScrub outline.on
$HandScrub clickable true

$Vitalsmonitor on
#$Vitalsmonitor outline.off

Do 'SummaryCheck.txt'

$PatientInPosition = 'false'

$GlobalVar setglobal 'UsingTool' false

#Do 'HandWash/SurgicalHandHygiene.txt'


Label 'LoopN1'

	$UsingTool =
	  $GlobalVar getGlobal 'UsingTool'

	If
		$HandScrub pressed
	Then
		$HandScrub reset
		Do 'UCGActions/HandScrub.txt'
	Endif

	If
		$SumButton pressed
	Then
		$SumButton reset
		$GlobalVar setglobal 'UsingTool' true
		$CheckCanvas off
		PatInfoCanvas off
		If
			$InterventionsCanvas isOn
		Then
			$UIMan closetoolinventory
		Endif
		Do 'SummaryCheck.txt'
		$GlobalVar setglobal 'UsingTool' false
	Endif

	If
		$PatientCheckTotal = 'True'
	Then
		wait 1    #wait for all GMs to finish up
		Do 'NEWS_Nurse/ChangeStage.txt'
	Endif

	If
		$EndGame isOnAndPressed
	Then
		#Do 'EndCheck.txt'
		If
			$BedNumber = 1
		Then
			ScoreTracker EndStage
		Endif

		Wait 1

		If
            $BedNumber = 1
        Then		
            ScoreTracker CloseStage
        Endif
        
        Wait 1  #needed for scorm
        SceneManager switchtoscene Scenes/MainMenu
	Endif

	If
		$PatientButton pressed
	Then
		$PatientButton reset
		Player align $PlayerStart 1
	Endif

	If
		$RightRail pressed
	Then
		$RightRail reset
		$RightRail clickable false
		$RightRail localmovey -.4 .5
		wait .3
		$RightRail localrotatex 180 0
		$RightRail outline.off
	Endif

	If
		$LeftHandButton pressed
	Then
		Prompt 'Left Hand is Active'
		Wait 1
		Prompt ''
		$LeftHandButton reset
		$ActiveHand = 'Left'
		$OtherHand = 'Right'
	Endif

	If
		$RightHandButton pressed
	Then
		Prompt 'Right Hand is Active'
		Wait 1
		Prompt ''
		$RightHandButton reset
		$ActiveHand = 'Right'
		$OtherHand = 'Left'
	Endif

	If
		$CartButton pressed
	Then
		$CartButton reset
		Player align $CartLook 1
		$CartObj outline.off
		$GlobalVar setglobal 'UsingTool' true
		turnOff $SumButton

		#$ECGCan on
		Wait 0
		/*
		$PlayerNurse align $CartNursePos 0
		Wait 0
		$PlayerNurse localMoveY -0.1 0
		Wait 0
		*/

		Do 'UCG/UCGCartStage3.txt'
	Endif

	If
		$ProcedureButton pressed
	Then
		$ProcedureButton reset
		Wait 0
		Player align $UrinaryProcPos 1
		Wait 1
		Player lookAt $PatientGenitals -0.05 0.2 .05 1
		Wait 1
	Endif

	If
		$Stage4Button pressed
	Then
		$Stage4Button reset
		$Stage = 4
		$GlobalVar setglobal 'Stage' $Stage
		turnOff $Stage4Button
		Do 'UCG/Stage4Loop.txt'
	Endif


	If
		$CartObj pressed
	Then
		$CartObj reset
		$CartObj outline.off
		$GlobalVar setglobal 'UsingTool' true
		Player align $CartLook .5
		turnOff $SumButton
		$CartObj clickable false

		Do 'UCG/UCGCartStage3.txt'
	Endif


	If
		$Curtain pressed
	Then
		$Curtain reset
		turnOff $Curtain
		turnOn $CurtainClosed
	Endif


	If
		$PatientSign pressed
	Then
		$PatientSign reset
		$GlobalVar setglobal 'UsingTool' true
		If
			$InterventionsCanvas isOn
		Then
			$UIMan closetoolinventory
		Endif
		Player align $LookAtPatientSign 1
		$ECGCan on
		label 'signLoop'
		If
			$BackECG pressed
		Then
			$BackECG reset
			$ECGCan off
			Player align $PlayerStart 1
			Wait .5
			$UseToolButton reset
			$GlobalVar setglobal 'UsingTool' false
			Goto 'LoopN1'
		Endif
		Goto 'signLoop'
	Endif

	If
		$PatientInPosition = 'false'
	Then
		If
			$Patient pressed
		Then
			$Patient reset
			Do 'UCGActions/PositionPatient.txt'
		Endif
	Endif

	If
		$Vitalsmonitor pressed
	Then
		$Vitalsmonitor reset
		Do 'ToolTxt/AssessECG.txt'
	Endif

	If
		$Scene_Exit pressed
	Then 
		$Scene_Exit reset
		#ScoreTracker rangecomplete 0-14
		Do 'EndCheck.txt'
	Endif

	If
		$Check_End pressed
	Then
		$Check_End reset
		$CheckCanvas off
	Endif

	Wait .2
Goto 'LoopN1'
